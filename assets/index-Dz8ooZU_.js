import{r as t,u as Y,a as Z,b as ee,j as e,c as se,t as y,d as ae,e as oe,f as i,F as o,C as m,g as C,h as M,i as $,B as L,L as ne,M as E,l as te,k as re,s as ie,m as le,n as ce}from"./index-CCBkej0x.js";const O=t.forwardRef(({bsPrefix:r,className:F,as:h="div",...f},g)=>{const N=Y(r,"row"),b=Z(),U=ee(),_=`${N}-cols`,v=[];return b.forEach(u=>{const d=f[u];delete f[u];let p;d!=null&&typeof d=="object"?{cols:p}=d:p=d;const a=u!==U?`-${u}`:"";p!=null&&v.push(`${_}${a}-${p}`)}),e.jsx(h,{ref:g,...f,className:se(F,N,...v)})});O.displayName="Row";const ue="_invalid_zof5e_31",l={"login-wrapper":"_login-wrapper_zof5e_1","forgot-password":"_forgot-password_zof5e_5","sign-up-wrapper":"_sign-up-wrapper_zof5e_12","sign-up-btn":"_sign-up-btn_zof5e_17","modal-sign-up-title":"_modal-sign-up-title_zof5e_26","invalid-feedback":"_invalid-feedback_zof5e_31","show-hide-password":"_show-hide-password_zof5e_38",invalid:ue},A={position:"top-right",autoClose:5e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!1,draggable:!1,progress:void 0,theme:"light"},H={info(r){return y.info(r,A)},success(r){return y.success(r,A)},warning(r){return y.warn(r,A)},error(r){return y.error(r,A)}};function me(){const r=ae(),F=oe();t.useEffect(()=>{localStorage.getItem("isAuthenticated")&&r("/")},[]),t.useEffect(()=>{localStorage.getItem("showToastOnLogin")&&(H.info("Bạn đã hết phiên đăng nhập"),localStorage.removeItem("showToastOnLogin"))},[]);const[h,f]=t.useState({username:"",password:""}),[g,N]=t.useState(!1),[b,U]=t.useState(!1),[_,v]=t.useState(""),u=t.useRef(null),d=t.useRef(null),p=t.useRef(null),[a,B]=t.useState({lastName:"",firstName:"",username:"",password:"",confirmPassword:""}),[Q,z]=t.useState(!1),[j,I]=t.useState(!1),[D,P]=t.useState(!1),[k,J]=t.useState([]),T=()=>{N(!g)},R=()=>{I(!j)},W=()=>z(!1),X=()=>z(!0),q=n=>{const{name:c,value:S}=n.target;f({...h,[c]:S})},G=async n=>{try{u.current.checkValidity()===!1?(n.preventDefault(),n.stopPropagation(),U(!0)):(await te(h),localStorage.setItem("isAuthenticated",!0),r("/"),(async()=>{const s=await re();F(ie({id:s==null?void 0:s.id,firstName:s==null?void 0:s.firstName,lastName:s==null?void 0:s.lastName,birthday:s==null?void 0:s.birthday,avatar:s==null?void 0:s.avatar,homeTown:s==null?void 0:s.homeTown,school:s==null?void 0:s.school,workplace:s==null?void 0:s.workplace})),le.connect()})())}catch(c){console.log(c),v("Tài khoản hoặc mật khẩu của bạn không chính xác")}},K=n=>{n.key==="Enter"&&G(n)},x=n=>{const{name:c,value:S}=n.target;B({...a,[c]:S})},V=async n=>{try{d.current.checkValidity()===!1?(n.preventDefault(),n.stopPropagation(),P(!0)):(await ce({lastName:a.lastName,firstName:a.firstName,username:a.username,password:a.password}),H.success("Đăng ký tài khoản thành công!"),B({lastName:"",firstName:"",username:"",password:"",confirmPassword:""}),I(!1),P(!1),z(!1))}catch(c){Number(c.status)===400&&(P(!0),J([...k,a.username]))}},w=n=>{n.key==="Enter"&&V(n)};return e.jsx("div",{className:"d-flex justify-content-center mt-5",children:e.jsxs("div",{className:i("p-4",l["login-wrapper"]),children:[e.jsxs(o,{ref:u,noValidate:!0,validated:b,children:[e.jsx(o.Group,{className:"mb-3",as:m,md:"12",children:e.jsx(o.Control,{value:h.username,name:"username",className:"fz-16",type:"text",placeholder:"Username",required:!0,onKeyUp:K,onChange:q})}),e.jsxs(o.Group,{className:"mb-3 position-relative",as:m,md:"12",children:[e.jsx(o.Control,{value:h.password,name:"password",className:"fz-16",type:g?"text":"password",placeholder:"Password",required:!0,onKeyUp:K,onChange:q}),g?e.jsx(C,{className:i(l["show-hide-password"]),icon:M,onClick:T}):e.jsx(C,{className:i(l["show-hide-password"]),icon:$,onClick:T})]}),_&&e.jsx("div",{className:i("mb-3",l["invalid-feedback"]),children:"Tài khoản hoặc mật khẩu của bạn không chính xác"})]}),e.jsx(L,{className:"w-100 fz-16",onClick:G,children:"Đăng nhập"}),e.jsx(ne,{to:"forgot-password",className:i(l["forgot-password"]),children:"Quên mật khẩu?"}),e.jsxs("div",{className:i("d-flex justify-content-center",l["sign-up-wrapper"]),children:[e.jsx(L,{className:i(l["sign-up-btn"]),onClick:X,children:"Tạo tài khoản mới"}),e.jsxs(E,{show:Q,onHide:W,children:[e.jsx(E.Header,{closeButton:!0,children:e.jsx(E.Title,{children:e.jsx("div",{className:i(l["modal-sign-up-title"]),children:"Đăng ký"})})}),e.jsx(E.Body,{children:e.jsxs(o,{ref:d,noValidate:!0,validated:D,children:[e.jsxs(O,{children:[e.jsx(o.Group,{className:"mb-3",as:m,md:"6",children:e.jsx(o.Control,{value:a.lastName,name:"lastName",className:"fz-16",placeholder:"Họ",required:!0,onKeyUp:w,onChange:x})}),e.jsx(o.Group,{className:"mb-3",as:m,md:"6",children:e.jsx(o.Control,{value:a.firstName,name:"firstName",className:"fz-16",placeholder:"Tên",required:!0,onKeyUp:w,onChange:x})})]}),e.jsxs(o.Group,{className:"mb-3",as:m,md:"12",children:[e.jsx(o.Control,{ref:p,value:a.username,name:"username",className:i("fz-16",{[l.invalid]:k.includes(a.username)}),placeholder:"Username",required:!0,onKeyUp:w,isInvalid:k.includes(a.username),onChange:x}),k.includes(a.username)&&e.jsx(o.Control.Feedback,{className:"fz-16",type:"invalid",children:"Tài khoản đã tồn tại"})]}),e.jsxs(o.Group,{className:"mb-3 position-relative",as:m,md:"12",children:[e.jsx(o.Control,{value:a.password,name:"password",type:j?"text":"password",className:"fz-16",minLength:6,placeholder:"Password",required:!0,onKeyUp:w,onChange:x}),e.jsx(o.Control.Feedback,{className:"fz-16",type:"invalid",children:"Mật khẩu ít nhất 6 ký tự"}),j?e.jsx(C,{className:i(l["show-hide-password"]),icon:M,onClick:R}):e.jsx(C,{className:i(l["show-hide-password"]),icon:$,onClick:R})]}),e.jsxs(o.Group,{className:"mb-3",as:m,md:"12",children:[e.jsx(o.Control,{value:a.confirmPassword,name:"confirmPassword",type:j?"text":"password",className:"fz-16",minLength:6,placeholder:"Confirm Password",required:!0,onKeyUp:w,pattern:a.password,isInvalid:D&&a.password!==a.confirmPassword,onChange:x}),D&&a.password!==a.confirmPassword&&e.jsx(o.Control.Feedback,{className:"fz-16",type:"invalid",children:"Mật khẩu xác nhận sai"})]})]})}),e.jsx(E.Footer,{children:e.jsx(L,{className:i("fz-16",l["sign-up-btn"]),onClick:V,children:"Đăng ký"})})]})]})]})})}export{me as default};
